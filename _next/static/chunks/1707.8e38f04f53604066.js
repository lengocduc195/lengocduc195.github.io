"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1707],{1368:(e,t,o)=>{let n;o.d(t,{A:()=>c});let r={randomUUID:"undefined"!=typeof crypto&&crypto.randomUUID&&crypto.randomUUID.bind(crypto)},i=new Uint8Array(16),a=[];for(let e=0;e<256;++e)a.push((e+256).toString(16).slice(1));let c=function(e,t,o){if(r.randomUUID&&!t&&!e)return r.randomUUID();let c=(e=e||{}).random??e.rng?.()??function(){if(!n){if("undefined"==typeof crypto||!crypto.getRandomValues)throw Error("crypto.getRandomValues() not supported. See https://github.com/uuidjs/uuid#getrandomvalues-not-supported");n=crypto.getRandomValues.bind(crypto)}return n(i)}();if(c.length<16)throw Error("Random bytes length must be >= 16");if(c[6]=15&c[6]|64,c[8]=63&c[8]|128,t){if((o=o||0)<0||o+16>t.length)throw RangeError(`UUID byte range ${o}:${o+15} is out of buffer bounds`);for(let e=0;e<16;++e)t[o+e]=c[e];return t}return function(e,t=0){return(a[e[t+0]]+a[e[t+1]]+a[e[t+2]]+a[e[t+3]]+"-"+a[e[t+4]]+a[e[t+5]]+"-"+a[e[t+6]]+a[e[t+7]]+"-"+a[e[t+8]]+a[e[t+9]]+"-"+a[e[t+10]]+a[e[t+11]]+a[e[t+12]]+a[e[t+13]]+a[e[t+14]]+a[e[t+15]]).toLowerCase()}(c)}},1707:(e,t,o)=>{o.r(t),o.d(t,{default:()=>y});var n=o(2115),r=o(5695),i=o(6104),a=o(1115),c=o(1368),d=o(9509);let l=()=>new Promise(e=>{if(!navigator.geolocation){console.log("Geolocation is not supported by this browser"),e({});return}navigator.geolocation.getCurrentPosition(t=>{e({latitude:t.coords.latitude,longitude:t.coords.longitude,accuracy:t.coords.accuracy,altitude:t.coords.altitude||void 0,altitudeAccuracy:t.coords.altitudeAccuracy||void 0,heading:t.coords.heading||void 0,speed:t.coords.speed||void 0})},t=>{console.log("Error getting geolocation:",t.message),e({})},{timeout:15e3,enableHighAccuracy:!0,maximumAge:0})}),s=async()=>{let e={country:"Unknown",city:"Unknown",lastUpdated:Date.now()};try{try{let e=await fetch("/api/geo");if(e.ok){let t=await e.json();if(t.success&&t.data)return{...t.data,lastUpdated:Date.now()}}}catch(e){console.error("Error fetching location from our API:",e)}try{e.timezone=Intl.DateTimeFormat().resolvedOptions().timeZone;let t=e.timezone.split("/");t.length>1&&(e.country=t[0].replace("_"," "),t.length>1&&(e.city=t[t.length-1].replace("_"," ")))}catch(e){console.error("Error getting timezone information:",e)}try{e.timezoneOffset=-new Date().getTimezoneOffset()/60}catch(e){console.error("Error calculating timezone offset:",e)}try{let t=navigator.userAgent,o=u(t);e.browser=o.browser,e.browserVersion=o.version,e.os=o.os,e.osVersion=o.osVersion,e.deviceType=m(t)}catch(e){console.error("Error detecting device information:",e)}return e}catch(e){console.error("Error fetching location from IP:",e);try{let e=Intl.DateTimeFormat().resolvedOptions().timeZone,t=e.split("/");return{country:t.length>1?t[0].replace("_"," "):"Unknown",city:t.length>1?t[t.length-1].replace("_"," "):"Unknown",timezone:e,lastUpdated:Date.now()}}catch(e){return console.error("Error creating fallback location data:",e),{country:"Unknown",city:"Unknown",lastUpdated:Date.now()}}}},u=e=>{let t="Unknown",o="Unknown",n="Unknown",r="Unknown";try{var i,a,c,d,l,s,u,m,g,f,p;e.indexOf("Firefox")>-1?(t="Firefox",o=(null==(i=e.match(/Firefox\/([\d.]+)/))?void 0:i[1])||""):e.indexOf("Opera")>-1||e.indexOf("OPR")>-1?(t="Opera",o=(null==(a=e.match(/(?:Opera|OPR)[\s/]([\d.]+)/))?void 0:a[1])||""):e.indexOf("Edg")>-1?(t="Edge",o=(null==(c=e.match(/Edg\/([\d.]+)/))?void 0:c[1])||""):e.indexOf("Chrome")>-1?(t="Chrome",o=(null==(d=e.match(/Chrome\/([\d.]+)/))?void 0:d[1])||""):e.indexOf("Safari")>-1?(t="Safari",o=(null==(l=e.match(/Version\/([\d.]+)/))?void 0:l[1])||""):(e.indexOf("MSIE")>-1||e.indexOf("Trident/")>-1)&&(t="Internet Explorer",o=(null==(s=e.match(/(?:MSIE |rv:)([\d.]+)/))?void 0:s[1])||""),e.indexOf("Windows")>-1?(n="Windows",e.indexOf("Windows NT 10.0")>-1?r="10":e.indexOf("Windows NT 6.3")>-1?r="8.1":e.indexOf("Windows NT 6.2")>-1?r="8":e.indexOf("Windows NT 6.1")>-1?r="7":e.indexOf("Windows NT 6.0")>-1?r="Vista":e.indexOf("Windows NT 5.1")>-1?r="XP":e.indexOf("Windows NT 5.0")>-1&&(r="2000")):e.indexOf("Mac")>-1?(n="macOS",r=(null==(m=e.match(/Mac OS X (\d+[._]\d+[._\d]*)/))||null==(u=m[1])?void 0:u.replace(/_/g,"."))||""):e.indexOf("Android")>-1?(n="Android",r=(null==(g=e.match(/Android ([\d.]+)/))?void 0:g[1])||""):e.indexOf("iOS")>-1||e.indexOf("iPhone")>-1||e.indexOf("iPad")>-1?(n="iOS",r=(null==(p=e.match(/OS (\d+[._]\d+[._\d]*)/))||null==(f=p[1])?void 0:f.replace(/_/g,"."))||""):e.indexOf("Linux")>-1&&(n="Linux")}catch(e){console.error("Error detecting browser information:",e)}return{browser:t,version:o,os:n,osVersion:r}},m=e=>/Mobi|Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(e)?/iPad|Tablet|Android(?!.*Mobile)/i.test(e)?"tablet":"mobile":"desktop",g=async()=>{let e={lastUpdated:Date.now()};try{let t=navigator.userAgent,o=u(t);e.browser=o.browser,e.browserVersion=o.version,e.os=o.os,e.osVersion=o.osVersion,e.deviceType=m(t),e.timezone=Intl.DateTimeFormat().resolvedOptions().timeZone;let n=new Date;e.timezoneOffset=-n.getTimezoneOffset()/60,e.localTime=p()}catch(e){console.error("Error getting browser information:",e)}try{let o=await l();if(o.latitude&&o.longitude){e={...e,...o};try{let n=await fetch("https://nominatim.openstreetmap.org/reverse?format=json&lat=".concat(o.latitude,"&lon=").concat(o.longitude,"&zoom=18&addressdetails=1"),{headers:{"User-Agent":"YourWebsite/1.0"}});if(n.ok){var t;let o=await n.json(),r=o.address;if(e={...e,country:r.country,countryCode:null==(t=r.country_code)?void 0:t.toUpperCase(),region:r.state||r.county||r.province,city:r.city||r.town||r.village||r.municipality,district:r.district||r.suburb||r.county,ward:r.suburb||r.neighbourhood||r.quarter,street:r.road||r.street||r.footway,streetNumber:r.house_number,postalCode:r.postcode,formattedAddress:o.display_name},"vn"===r.country_code&&r.road){let t=r.road;r.house_number&&(t="".concat(r.house_number," ").concat(t));let o=[];(r.suburb||r.neighbourhood||r.quarter)&&o.push(r.suburb||r.neighbourhood||r.quarter),(r.district||r.county)&&o.push(r.district||r.county),(r.city||r.town||r.village)&&o.push(r.city||r.town||r.village),(r.state||r.province)&&o.push(r.state||r.province),o.length>0&&(t="".concat(t,", ").concat(o.join(", "))),e.formattedAddress=t}}}catch(e){console.error("Error with reverse geocoding:",e)}try{let t=d.env.NEXT_PUBLIC_GOOGLE_MAPS_API_KEY;if(t){let n=await fetch("https://maps.googleapis.com/maps/api/geocode/json?latlng=".concat(o.latitude,",").concat(o.longitude,"&key=").concat(t));if(n.ok){let t=await n.json();if("OK"===t.status&&t.results&&t.results.length>0){let o=t.results[0];for(let t of(e.formattedAddress||(e.formattedAddress=o.formatted_address),o.address_components)){let o=t.types;o.includes("street_number")?e.streetNumber=t.long_name:o.includes("route")?e.street=t.long_name:o.includes("sublocality")||o.includes("sublocality_level_1")?e.ward=t.long_name:o.includes("administrative_area_level_2")?e.district=t.long_name:o.includes("locality")?e.city=t.long_name:o.includes("administrative_area_level_1")?(e.region=t.long_name,e.regionCode=t.short_name):o.includes("country")?(e.country=t.long_name,e.countryCode=t.short_name):o.includes("postal_code")&&(e.postalCode=t.long_name)}}}}}catch(e){console.error("Error with Google geocoding:",e)}}}catch(e){console.error("Error getting browser geolocation:",e)}if(!e.latitude||!e.longitude||!e.country)try{let t={...await s()};e.latitude&&e.longitude&&(t.latitude=e.latitude,t.longitude=e.longitude,t.accuracy=e.accuracy,t.altitude=e.altitude,t.altitudeAccuracy=e.altitudeAccuracy,t.heading=e.heading,t.speed=e.speed),e.formattedAddress&&(t.formattedAddress=e.formattedAddress,t.street=e.street||t.street,t.streetNumber=e.streetNumber||t.streetNumber,t.ward=e.ward||t.ward,t.district=e.district||t.district,t.city=e.city||t.city,t.region=e.region||t.region,t.regionCode=e.regionCode||t.regionCode,t.country=e.country||t.country,t.countryCode=e.countryCode||t.countryCode,t.postalCode=e.postalCode||t.postalCode),t.browser=e.browser,t.browserVersion=e.browserVersion,t.os=e.os,t.osVersion=e.osVersion,t.deviceType=e.deviceType,t.timezone=e.timezone||t.timezone,t.timezoneOffset=e.timezoneOffset||t.timezoneOffset,t.localTime=e.localTime,t.lastUpdated=Date.now(),e=t}catch(e){console.error("Error getting IP-based location:",e)}try{let t=navigator.connection||navigator.mozConnection||navigator.webkitConnection;t&&(e.connectionType=t.effectiveType||t.type)}catch(e){console.error("Error getting connection information:",e)}return e},f=()=>{let e=new Date,t=Intl.DateTimeFormat().resolvedOptions().timeZone,o=-e.getTimezoneOffset()/60,n=o>=0?"+":"-",r="UTC".concat(n).concat(Math.abs(o)),i=e.getFullYear(),a=e.getMonth()+1,c=e.getDate(),d=["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"][e.getDay()],l=e.getHours(),s=e.getMinutes(),u=e.getSeconds(),m=e.getMilliseconds(),g=e.toISOString(),f=e=>e.toString().padStart(2,"0");return{iso8601:g,formatted:"".concat(i,"-").concat(f(a),"-").concat(f(c)," ").concat(f(l),":").concat(f(s),":").concat(f(u)," (").concat(r,")"),timestamp:e.getTime(),date:{year:i,month:a,day:c,weekday:d},time:{hour:l,minute:s,second:u,millisecond:m},timezone:{name:t,offset:o,offsetString:r}}},p=()=>f().formatted;var v=o(283);let h=()=>{var e,t,o,n,r,i,a,c,d;let l=navigator.userAgent,s="Unknown",u="Unknown",m="Unknown",g="Unknown",f=!1,p="desktop",v=navigator.vendor||"Unknown",h=navigator.platform||"Unknown";if(l.indexOf("Firefox")>-1?(s="Firefox",u=(null==(e=l.match(/Firefox\/([\d.]+)/))?void 0:e[1])||"Unknown"):l.indexOf("Chrome")>-1&&-1===l.indexOf("Edg")&&-1===l.indexOf("OPR")?(s="Chrome",u=(null==(t=l.match(/Chrome\/([\d.]+)/))?void 0:t[1])||"Unknown"):l.indexOf("Safari")>-1&&-1===l.indexOf("Chrome")?(s="Safari",u=(null==(o=l.match(/Version\/([\d.]+)/))?void 0:o[1])||"Unknown"):l.indexOf("Edg")>-1?(s="Edge",u=(null==(n=l.match(/Edg\/([\d.]+)/))?void 0:n[1])||"Unknown"):l.indexOf("OPR")>-1||l.indexOf("Opera")>-1?(s="Opera",u=(null==(r=l.match(/(?:OPR|Opera)[\s/]([\d.]+)/))?void 0:r[1])||"Unknown"):l.indexOf("Trident")>-1||l.indexOf("MSIE")>-1?(s="Internet Explorer",u=(null==(i=l.match(/(?:MSIE |rv:)([\d.]+)/))?void 0:i[1])||"Unknown"):l.indexOf("UCBrowser")>-1?(s="UC Browser",u=(null==(a=l.match(/UCBrowser\/([\d.]+)/))?void 0:a[1])||"Unknown"):l.indexOf("SamsungBrowser")>-1&&(s="Samsung Browser",u=(null==(c=l.match(/SamsungBrowser\/([\d.]+)/))?void 0:c[1])||"Unknown"),l.indexOf("Windows")>-1)m="Windows",l.indexOf("Windows NT 10.0")>-1?g="10":l.indexOf("Windows NT 6.3")>-1?g="8.1":l.indexOf("Windows NT 6.2")>-1?g="8":l.indexOf("Windows NT 6.1")>-1?g="7":l.indexOf("Windows NT 6.0")>-1?g="Vista":l.indexOf("Windows NT 5.1")>-1?g="XP":l.indexOf("Windows NT 5.0")>-1&&(g="2000");else if(l.indexOf("Mac")>-1){m="macOS";let e=l.match(/Mac OS X (\d+[._]\d+[._\d]*)/);e&&(g=e[1].replace(/_/g,"."))}else if(l.indexOf("Android")>-1)m="Android",g=(null==(d=l.match(/Android ([\d.]+)/))?void 0:d[1])||"Unknown",f=!0;else if(l.indexOf("iOS")>-1||l.indexOf("iPhone")>-1||l.indexOf("iPad")>-1){m="iOS";let e=l.match(/OS (\d+[._]\d+[._\d]*)/);e&&(g=e[1].replace(/_/g,".")),f=!0}else l.indexOf("Linux")>-1&&(m="Linux",l.indexOf("Ubuntu")>-1?g="Ubuntu":l.indexOf("Fedora")>-1?g="Fedora":l.indexOf("Debian")>-1&&(g="Debian"));return/Mobi|Android|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(l)&&(/iPad|Tablet|Android(?!.*Mobile)/i.test(l)?p="tablet":(p="mobile",f=!0)),!f&&window.innerWidth<=768&&(f=!0,p=window.innerWidth<=480?"mobile":"tablet"),{browser:s,version:u,os:m,osVersion:g,mobile:f,deviceType:p,vendor:v,platform:h}},w=()=>{let e=localStorage.getItem("visitor_session_id");if(e){let t=parseInt(localStorage.getItem("session_start_time")||"0",10);Date.now()-t>18e5&&(e=(0,c.A)(),localStorage.setItem("visitor_session_id",e),localStorage.setItem("session_start_time",Date.now().toString()))}else e=(0,c.A)(),localStorage.setItem("visitor_session_id",e),localStorage.setItem("session_start_time",Date.now().toString());return e};function y(){let e=(0,r.usePathname)(),t=(0,r.useSearchParams)(),{currentUser:o,userRole:c}=(0,v.A)(),[d,l]=(0,n.useState)(""),[s,u]=(0,n.useState)(0),[m,p]=(0,n.useState)(!1);return(0,n.useEffect)(()=>{i.v$&&"false"!==localStorage.getItem("analytics_consent")&&(l(w()),u(Date.now()),p(!1))},[e,t]),(0,n.useEffect)(()=>{i.v$&&d&&!m&&"false"!==localStorage.getItem("analytics_consent")&&(async()=>{try{let n=await g(),r=f(),l=r.formatted,s={width:window.innerWidth,height:window.innerHeight,colorDepth:window.screen.colorDepth,pixelRatio:window.devicePixelRatio,orientation:window.screen.orientation?window.screen.orientation.type:window.innerWidth>window.innerHeight?"landscape":"portrait"},u=h(),m={};try{let e=navigator.connection||navigator.mozConnection||navigator.webkitConnection;e&&(e.effectiveType&&(m.effectiveType=e.effectiveType),void 0!==e.downlink&&(m.downlink=e.downlink),void 0!==e.rtt&&(m.rtt=e.rtt),void 0!==e.saveData&&(m.saveData=e.saveData))}catch(e){console.error("Error getting connection information:",e)}let v={};try{let e=navigator.deviceMemory,t=navigator.hardwareConcurrency;if(void 0!==e&&(v.deviceMemory=e),void 0!==t&&(v.cpuCores=t),"getBattery"in navigator)try{let e=await navigator.getBattery();e&&(void 0!==e.level&&(v.batteryLevel=e.level),void 0!==e.charging&&(v.batteryCharging=e.charging))}catch(e){console.error("Error getting battery information:",e)}}catch(e){console.error("Error getting hardware information:",e)}let w=!document.referrer||!document.referrer.includes(window.location.hostname),y={};t&&["utm_source","utm_medium","utm_campaign","utm_term","utm_content"].forEach(e=>{let o=t.get(e);o&&(y[e]=o)});let b="direct";if(document.referrer){let e=new URL(document.referrer).hostname;b=e.includes("google")?"google":e.includes("bing")?"bing":e.includes("yahoo")?"yahoo":e.includes("facebook")||e.includes("fb.com")?"facebook":e.includes("instagram")?"instagram":e.includes("twitter")||e.includes("t.co")?"twitter":e.includes("linkedin")?"linkedin":e.includes("youtube")?"youtube":e!==window.location.hostname?"external":"internal"}else Object.keys(y).length>0&&(b=y.utm_source||"campaign");let x=navigator.languages?Array.from(navigator.languages):[navigator.language],O=document.title,E="other";"/"===e||"/home"===e?E="home":e.includes("/shop")?E="shop":e.includes("/product")?E="product":e.includes("/category")?E="category":e.includes("/blog")||e.includes("/article")?E="article":e.includes("/about")?E="about":e.includes("/contact")&&(E="contact");let _={sessionId:d,...(null==o?void 0:o.uid)?{userId:o.uid}:{},userRole:c||"viewer",isAuthenticated:!!o,timestamp:Date.now(),page:e,referrer:document.referrer||"",queryParams:{},userAgent:navigator.userAgent,language:navigator.language,languages:x,screenSize:s,browserInfo:u,location:n,timeInfo:r,localTime:l,...Object.keys(m).length>0?{connectionInfo:m}:{},entryPage:w,landingSource:b,...Object.keys(y).length>0?{utmParameters:{source:y.utm_source||null,medium:y.utm_medium||null,campaign:y.utm_campaign||null,term:y.utm_term||null,content:y.utm_content||null}}:{},...v&&Object.keys(v).length>0?{hardwareInfo:v}:{}};if(t&&t.toString()){let e={};t.forEach((t,o)=>{e[o]=t}),_.queryParams=e}let T=(0,a.KR)(i.v$,"analytics/visitors"),S=(0,a.VC)(T);await (0,a.hZ)(S,{..._,timestamp:(0,a.O5)()});let C=(0,a.KR)(i.v$,"analytics/pageViews"),k=(0,a.VC)(C);await (0,a.hZ)(k,{sessionId:d,...(null==o?void 0:o.uid)?{userId:o.uid}:{},userRole:c||"viewer",isAuthenticated:!!o,page:e,pageTitle:O,pageType:E,timestamp:(0,a.O5)(),timeInfo:r,referrer:document.referrer||"",referrerDomain:document.referrer?new URL(document.referrer).hostname:void 0,entryPage:w,location:{country:n.country,countryCode:n.countryCode,region:n.region,regionCode:n.regionCode,city:n.city,district:n.district,ward:n.ward,street:n.street,postalCode:n.postalCode,formattedAddress:n.formattedAddress,timezone:n.timezone,isp:n.isp,connectionType:n.connectionType},...y.utm_source?{utmSource:y.utm_source}:{},...y.utm_medium?{utmMedium:y.utm_medium}:{},...y.utm_campaign?{utmCampaign:y.utm_campaign}:{},...y.utm_term?{utmTerm:y.utm_term}:{},...y.utm_content?{utmContent:y.utm_content}:{},queryParams:_.queryParams,deviceType:u.deviceType,browser:u.browser,os:u.os}),p(!0),console.log("Enhanced visitor and page view data saved to Firebase")}catch(e){console.error("Error saving visitor data to Firebase:",e)}})()},[e,t,d,m]),(0,n.useEffect)(()=>{if(!i.v$||!d||"false"===localStorage.getItem("analytics_consent"))return;let t=Date.now(),n=!0,r=0,l=0,u=null,m=null,g=()=>{if(!n){let e=Math.floor((Date.now()-t)/1e3);l+=e}t=Date.now(),n=!0};u=setInterval(()=>{let e=Date.now()-t;n&&e>3e4?n=!1:n&&(r+=5)},5e3),m=setInterval(async()=>{if(!s)return;let t=Math.floor((Date.now()-s)/1e3);if(t>5)try{let s=f(),u=(0,a.KR)(i.v$,"analytics/timeSpent"),m=(0,a.VC)(u);await (0,a.hZ)(m,{sessionId:d,...(null==o?void 0:o.uid)?{userId:o.uid}:{},userRole:c||"viewer",isAuthenticated:!!o,page:e,pageTitle:document.title,timestamp:(0,a.O5)(),timeInfo:s,timeSpent:t,activeTime:r,inactiveTime:l,isActive:n,periodicUpdate:!0,viewportWidth:window.innerWidth,viewportHeight:window.innerHeight})}catch(e){console.error("Error saving periodic time spent data:",e)}},3e4);let p=async()=>{if(!s)return;let u=Math.floor((Date.now()-s)/1e3);if(n){let e=Math.floor((Date.now()-t)/1e3);r+=e}else{let e=Math.floor((Date.now()-t)/1e3);l+=e}if(u>1)try{let t=f(),s=(0,a.KR)(i.v$,"analytics/timeSpent"),m=(0,a.VC)(s);await (0,a.hZ)(m,{sessionId:d,...(null==o?void 0:o.uid)?{userId:o.uid}:{},userRole:c||"viewer",isAuthenticated:!!o,page:e,pageTitle:document.title,timestamp:(0,a.O5)(),timeInfo:t,timeSpent:u,activeTime:r,inactiveTime:l,isActive:n,exitPage:!0,viewportWidth:window.innerWidth,viewportHeight:window.innerHeight,scrollDepth:v()})}catch(e){console.error("Error saving final time spent data:",e)}},v=()=>{let e=window.scrollY||document.documentElement.scrollTop,t=document.documentElement.scrollHeight-document.documentElement.clientHeight;return t>0?Math.round(e/t*100):0},h=["mousedown","mousemove","keydown","scroll","touchstart","click"];return h.forEach(e=>{document.addEventListener(e,g)}),window.addEventListener("beforeunload",p),()=>{h.forEach(e=>{document.removeEventListener(e,g)}),window.removeEventListener("beforeunload",p),u&&clearInterval(u),m&&clearInterval(m),p()}},[e,d,s,o,c]),(0,n.useEffect)(()=>{if(!i.v$||!d||"false"===localStorage.getItem("analytics_consent"))return;let t=async(t,n,r,l,u)=>{try{let m=document.title,g=s?Date.now()-s:void 0,f=l;if(l){let e=window.innerWidth,t=window.innerHeight,o=window.scrollY||document.documentElement.scrollTop,n=document.documentElement.scrollHeight-document.documentElement.clientHeight,r=n>0?Math.round(o/n*100):0;f={...l,relativeX:e>0?l.x/e:void 0,relativeY:t>0?l.y/t:void 0,scrollDepth:r}}let p={sessionId:d,...(null==o?void 0:o.uid)?{userId:o.uid}:{},userRole:c||"viewer",isAuthenticated:!!o,page:e,pageTitle:m,timestamp:Date.now(),timeFromPageLoad:g,type:t,target:n,value:r,position:f,...u},v=(0,a.KR)(i.v$,"analytics/interactions"),h=(0,a.VC)(v);await (0,a.hZ)(h,{...p,timestamp:(0,a.O5)()})}catch(e){console.error("Error saving interaction data:",e)}},n=e=>{var o,n,r;let i=e.target,a=i.id||"",c=i.className||"",d=i.tagName.toLowerCase(),l=(null==(o=i.textContent)?void 0:o.trim().slice(0,100))||"",s=i.tagName+(a?"#".concat(a):"")+(c?".".concat(c.replace(/\s+/g,".")):""),u="click",m={targetId:a,targetClass:c,targetType:d,targetText:l},g=i.closest("a");g&&(u="link_click",m.value=g.href||"",m.target="a".concat(g.id?"#".concat(g.id):""),m.targetText=(null==(n=g.textContent)?void 0:n.trim().slice(0,100))||"");let f=i.closest("button");f&&(u="button_click",m.target="button".concat(f.id?"#".concat(f.id):""),m.targetText=(null==(r=f.textContent)?void 0:r.trim().slice(0,100))||""),t(u,s,l,{x:e.clientX,y:e.clientY},m)},r=0,l=Date.now(),u=()=>{let e=window.scrollY||document.documentElement.scrollTop,o=document.documentElement.scrollHeight-document.documentElement.clientHeight,n=Math.round(e/o*100),i=Date.now()-l;if(n>=r+25||100===n){let a=i>0?Math.round((e-r/100*o)/(i/1e3)):0;t("scroll","window","".concat(n,"%"),void 0,{position:{scrollDepth:n},value:"".concat(n,"%"),context:"Scroll speed: ".concat(a,"px/s, Duration: ").concat(Math.round(i/1e3),"s")}),r=n,l=Date.now()}},m=e=>{let o=e.target,n=o.id||"",r=o.name||"",i=o.action||"",a=o.method||"",c=Array.from(o.elements).filter(e=>"BUTTON"!==e.tagName).map(e=>e.name||e.id||e.type).filter(Boolean);t("form_submit","form".concat(n?"#".concat(n):""),i,void 0,{formData:{formId:n,formName:r,formFields:c,formAction:i,formMethod:a}})},g=e=>{let o,n=e.target,r=n.id||"",i=n.currentSrc||"",a=n.duration||0,c=n.currentTime||0,d=a>0?Math.round(c/a*100):0;if("play"===e.type)o="video_play";else if("pause"===e.type)o="video_pause";else{if("ended"!==e.type)return;o="video_complete"}t(o,"video".concat(r?"#".concat(r):""),i,void 0,{value:"".concat(d,"%"),context:"Duration: ".concat(Math.round(a),"s, Current time: ").concat(Math.round(c),"s")})},f=e=>{let o=e.currentTarget,n=o.href||"";if([".pdf",".doc",".docx",".xls",".xlsx",".ppt",".pptx",".zip",".rar",".txt",".csv",".jpg",".jpeg",".png",".gif"].some(e=>n.toLowerCase().endsWith(e))){var r;t("file_download","a".concat(o.id?"#".concat(o.id):""),n,{x:e.clientX,y:e.clientY},{targetText:(null==(r=o.textContent)?void 0:r.trim().slice(0,100))||"",value:n.split("/").pop()||n})}},p=e=>{let o=e.target,n=o.querySelector('input[type="search"], input[name="q"], input[name="query"], input[name="search"]');n&&n.value&&t("search","form".concat(o.id?"#".concat(o.id):""),n.value,void 0,{formData:{formId:o.id||"",formName:o.name||"",formAction:o.action||"",formMethod:o.method||""}})},v=e=>{var o;let n=null==(o=window.getSelection())?void 0:o.toString().trim();n&&n.length>0&&t("copy","document",n.length>100?"".concat(n.substring(0,100),"..."):n,void 0,{context:"Length: ".concat(n.length," characters")})},h=null,w=null,y=e=>{let o=e.target;("A"===o.tagName||"BUTTON"===o.tagName||"INPUT"===o.tagName||"SELECT"===o.tagName||"TEXTAREA"===o.tagName||o.closest("a")||o.closest("button"))&&(h&&clearTimeout(h),o!==w&&(w=o,h=setTimeout(()=>{var n;let r=o.id||"",i=o.className||"",a=o.tagName.toLowerCase(),c=(null==(n=o.textContent)?void 0:n.trim().slice(0,100))||"";t("hover",o.tagName+(r?"#".concat(r):"")+(i?".".concat(i.replace(/\s+/g,".")):""),c,{x:e.clientX,y:e.clientY},{targetId:r,targetClass:i,targetType:a,targetText:c})},1e3)))},b=()=>{h&&(clearTimeout(h),h=null),w=null};document.addEventListener("click",n),document.addEventListener("scroll",u),document.addEventListener("mousemove",y),document.addEventListener("mouseleave",b),document.addEventListener("copy",v);let x=document.querySelectorAll("form");x.forEach(e=>{e.addEventListener("submit",m),(null!==e.querySelector('input[type="search"]')||null!==e.querySelector('input[name="q"]')||null!==e.querySelector('input[name="query"]')||null!==e.querySelector('input[name="search"]'))&&e.addEventListener("submit",p)});let O=document.querySelectorAll("video");O.forEach(e=>{e.addEventListener("play",g),e.addEventListener("pause",g),e.addEventListener("ended",g)});let E=document.querySelectorAll("a[href]");return E.forEach(e=>{let t=e.href||"";[".pdf",".doc",".docx",".xls",".xlsx",".ppt",".pptx",".zip",".rar",".txt",".csv",".jpg",".jpeg",".png",".gif"].some(e=>t.toLowerCase().endsWith(e))&&e.addEventListener("click",f)}),()=>{if(document.removeEventListener("click",n),document.removeEventListener("scroll",u),document.removeEventListener("mousemove",y),document.removeEventListener("mouseleave",b),document.removeEventListener("copy",v),x.forEach(e=>{e.removeEventListener("submit",m),(null!==e.querySelector('input[type="search"]')||null!==e.querySelector('input[name="q"]')||null!==e.querySelector('input[name="query"]')||null!==e.querySelector('input[name="search"]'))&&e.removeEventListener("submit",p)}),O.forEach(e=>{e.removeEventListener("play",g),e.removeEventListener("pause",g),e.removeEventListener("ended",g)}),E.forEach(e=>{let t=e.href||"";[".pdf",".doc",".docx",".xls",".xlsx",".ppt",".pptx",".zip",".rar",".txt",".csv",".jpg",".jpeg",".png",".gif"].some(e=>t.toLowerCase().endsWith(e))&&e.removeEventListener("click",f)}),s){let t=Math.floor((Date.now()-s)/1e3);if(t>1&&i.v$)try{let n=(0,a.KR)(i.v$,"analytics/timeSpent"),r=(0,a.VC)(n);(0,a.hZ)(r,{sessionId:d,...(null==o?void 0:o.uid)?{userId:o.uid}:{},userRole:c||"viewer",isAuthenticated:!!o,page:e,pageTitle:document.title,timeSpent:t,timestamp:(0,a.O5)(),exitPage:!0})}catch(e){console.error("Error saving final time spent data:",e)}}h&&clearTimeout(h)}},[e,d]),null}}}]);