(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[8733],{2899:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>c});var a=t(5155),r=t(2115),n=t(5695),l=t(6104),i=t(1115),o=t(4126),d=t(9599);let c=(0,o.P)(function(){let[e,s]=(0,r.useState)([]),[t,o]=(0,r.useState)(!0),[c,u]=(0,r.useState)(null),[m,x]=(0,r.useState)(null),[h,g]=(0,r.useState)(!1),[p,b]=(0,r.useState)(!1),[f,y]=(0,r.useState)(null),[v,j]=(0,r.useState)(""),[w,N]=(0,r.useState)("all");(0,n.useRouter)(),(0,r.useEffect)(()=>{(async()=>{if(!l.v$){u("Firebase Realtime Database is not initialized"),o(!1);return}try{let e=(0,i.KR)(l.v$,"users"),t=await (0,i.Jt)(e),a=[];t.exists()&&t.forEach(e=>{let s=e.val();a.push({id:e.key||"",email:s.email||"",name:s.name||s.displayName||"",role:s.role||"user",createdAt:s.createdAt||"",lastLogin:s.lastLogin||"",phone:s.phone||"",address:s.address||""})});let r=(0,i.KR)(l.v$,"analytics/visitors"),n=await (0,i.Jt)(r);if(n.exists()){let e=new Set,s=new Set;n.forEach(e=>{let t=e.val();t.isAuthenticated&&t.sessionId&&s.add(t.sessionId)}),n.forEach(t=>{let r=t.val();if(r.sessionId&&!s.has(r.sessionId)&&!e.has(r.sessionId)){var n;e.add(r.sessionId),a.push({id:"session_".concat(r.sessionId),email:"Anonymous Visitor",name:"Visitor ".concat(e.size),role:"viewer",createdAt:r.timestamp||"",lastLogin:r.timestamp||"",phone:"",address:(null==(n=r.location)?void 0:n.formattedAddress)||""})}})}a.sort((e,s)=>{let t=e.lastLogin?new Date(e.lastLogin).getTime():0;return(s.lastLogin?new Date(s.lastLogin).getTime():0)-t}),s(a),o(!1)}catch(e){console.error("Error fetching users:",e),u(e.message||"Failed to load users"),o(!1)}})()},[]);let C=e=>{if("viewer"===e.role&&e.id.startsWith("session_"))return void alert("Cannot edit anonymous visitors");x({...e}),g(!0)},k=e=>{if("viewer"===e.role&&e.id.startsWith("session_"))return void alert("Cannot delete anonymous visitors");y(e),b(!0)},S=async()=>{if(m&&l.v$)try{let t=(0,i.KR)(l.v$,"users/".concat(m.id));await (0,i.yo)(t,{name:m.name,role:m.role,phone:m.phone,address:m.address}),s(e.map(e=>e.id===m.id?{...e,...m}:e)),g(!1),x(null)}catch(e){console.error("Error updating user:",e),u(e.message||"Failed to update user")}},E=async()=>{if(f&&l.v$)try{let t=(0,i.KR)(l.v$,"users/".concat(f.id));await (0,i.TF)(t),s(e.filter(e=>e.id!==f.id)),b(!1),y(null)}catch(e){console.error("Error deleting user:",e),u(e.message||"Failed to delete user")}},A=e.filter(e=>{let s=e.email.toLowerCase().includes(v.toLowerCase())||e.name&&e.name.toLowerCase().includes(v.toLowerCase())||e.phone&&e.phone.includes(v),t="all"===w||e.role===w;return s&&t});return t?(0,a.jsxs)("div",{className:"container mx-auto p-6",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold mb-6",children:"User Management"}),(0,a.jsx)("p",{children:"Loading users..."})]}):c?(0,a.jsxs)("div",{className:"container mx-auto p-6",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold mb-6",children:"User Management"}),(0,a.jsx)("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded",children:(0,a.jsx)("p",{children:c})})]}):(0,a.jsxs)("div",{className:"container mx-auto p-6",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold mb-6",children:"User Management"}),(0,a.jsxs)("div",{className:"flex flex-col md:flex-row gap-4 mb-6",children:[(0,a.jsx)("div",{className:"flex-1",children:(0,a.jsx)("input",{type:"text",placeholder:"Search by email, name or phone...",value:v,onChange:e=>j(e.target.value),className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-md text-white focus:outline-none focus:ring-2 focus:ring-blue-500"})}),(0,a.jsx)("div",{children:(0,a.jsxs)("select",{value:w,onChange:e=>N(e.target.value),className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-md text-white focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,a.jsx)("option",{value:"all",children:"All Roles"}),(0,a.jsx)("option",{value:"viewer",children:"Viewers"}),(0,a.jsx)("option",{value:"user",children:"Registered Users"}),(0,a.jsx)("option",{value:"editor",children:"Editors"}),(0,a.jsx)("option",{value:"moderator",children:"Moderators"}),(0,a.jsx)("option",{value:"admin",children:"Admins"}),(0,a.jsx)("option",{value:"superadmin",children:"Super Admins"})]})})]}),(0,a.jsx)("div",{className:"bg-gray-800 rounded-lg shadow-lg overflow-hidden",children:(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"min-w-full divide-y divide-gray-700",children:[(0,a.jsx)("thead",{className:"bg-gray-700",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider",children:"Email"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider",children:"Name"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider",children:"Role"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider",children:"Last Login"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-300 uppercase tracking-wider",children:"Actions"})]})}),(0,a.jsx)("tbody",{className:"divide-y divide-gray-700",children:A.length>0?A.map(e=>(0,a.jsxs)("tr",{className:"hover:bg-gray-700",children:[(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:e.email}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:e.name||"-"}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:(0,a.jsx)("span",{className:"px-2 py-1 rounded-full text-xs ".concat("admin"===e.role?"bg-red-900 text-red-200":"moderator"===e.role?"bg-yellow-900 text-yellow-200":"editor"===e.role?"bg-green-900 text-green-200":"bg-blue-900 text-blue-200"),children:(0,d.cb)(e.role)})}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:e.lastLogin?new Date(e.lastLogin).toLocaleString():"Never"}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:"viewer"===e.role&&e.id.startsWith("session_")?(0,a.jsx)("span",{className:"text-gray-500",children:"Anonymous"}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)("button",{onClick:()=>C(e),className:"text-blue-400 hover:text-blue-300 mr-3",children:"Edit"}),(0,a.jsx)("button",{onClick:()=>k(e),className:"text-red-400 hover:text-red-300",children:"Delete"})]})})]},e.id)):(0,a.jsx)("tr",{children:(0,a.jsx)("td",{colSpan:5,className:"px-6 py-4 text-center text-gray-400",children:"No users found"})})})]})})}),h&&m&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:(0,a.jsxs)("div",{className:"bg-gray-800 rounded-lg p-6 max-w-md w-full",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Edit User"}),(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("label",{className:"block text-gray-300 text-sm font-medium mb-2",children:"Email"}),(0,a.jsx)("input",{type:"text",value:m.email,disabled:!0,className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-md text-gray-400 cursor-not-allowed"})]}),(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("label",{className:"block text-gray-300 text-sm font-medium mb-2",children:"Name"}),(0,a.jsx)("input",{type:"text",value:m.name||"",onChange:e=>x({...m,name:e.target.value}),className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-md text-white focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("label",{className:"block text-gray-300 text-sm font-medium mb-2",children:"Role"}),(0,a.jsxs)("select",{value:m.role,onChange:e=>x({...m,role:e.target.value}),className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-md text-white focus:outline-none focus:ring-2 focus:ring-blue-500",children:[(0,a.jsx)("option",{value:"viewer",children:"Viewer"}),(0,a.jsx)("option",{value:"user",children:"User"}),(0,a.jsx)("option",{value:"editor",children:"Editor"}),(0,a.jsx)("option",{value:"moderator",children:"Moderator"}),(0,a.jsx)("option",{value:"admin",children:"Admin"}),(0,a.jsx)("option",{value:"superadmin",children:"Super Admin"})]})]}),(0,a.jsxs)("div",{className:"mb-4",children:[(0,a.jsx)("label",{className:"block text-gray-300 text-sm font-medium mb-2",children:"Phone"}),(0,a.jsx)("input",{type:"text",value:m.phone||"",onChange:e=>x({...m,phone:e.target.value}),className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-md text-white focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),(0,a.jsxs)("div",{className:"mb-6",children:[(0,a.jsx)("label",{className:"block text-gray-300 text-sm font-medium mb-2",children:"Address"}),(0,a.jsx)("textarea",{value:m.address||"",onChange:e=>x({...m,address:e.target.value}),className:"w-full px-4 py-2 bg-gray-700 border border-gray-600 rounded-md text-white focus:outline-none focus:ring-2 focus:ring-blue-500",rows:3})]}),(0,a.jsxs)("div",{className:"flex justify-end space-x-3",children:[(0,a.jsx)("button",{onClick:()=>g(!1),className:"px-4 py-2 bg-gray-600 text-white rounded-md hover:bg-gray-700",children:"Cancel"}),(0,a.jsx)("button",{onClick:S,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700",children:"Save Changes"})]})]})}),p&&f&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:(0,a.jsxs)("div",{className:"bg-gray-800 rounded-lg p-6 max-w-md w-full",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Confirm Delete"}),(0,a.jsxs)("p",{className:"mb-6",children:["Are you sure you want to delete the user ",(0,a.jsx)("span",{className:"font-semibold",children:f.email}),"? This action cannot be undone."]}),(0,a.jsxs)("div",{className:"flex justify-end space-x-3",children:[(0,a.jsx)("button",{onClick:()=>b(!1),className:"px-4 py-2 bg-gray-600 text-white rounded-md hover:bg-gray-700",children:"Cancel"}),(0,a.jsx)("button",{onClick:E,className:"px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700",children:"Delete User"})]})]})})]})})},4126:(e,s,t)=>{"use strict";t.d(s,{AdminProvider:()=>u,P:()=>m,z:()=>c});var a=t(5155),r=t(2115),n=t(5695),l=t(6104),i=t(283),o=t(9599);let d=(0,r.createContext)({isAdmin:!1,adminLoading:!0,adminUser:null}),c=()=>(0,r.useContext)(d),u=e=>{let{children:s}=e,{currentUser:t,loading:c,userRole:u}=(0,i.A)(),[m,x]=(0,r.useState)(!1),[h,g]=(0,r.useState)(!0),[p,b]=(0,r.useState)(null);return(0,n.useRouter)(),(0,r.useEffect)(()=>{(async()=>{if(!c){if(!t){x(!1),b(null),g(!1);return}try{let e=(0,o.Mu)(u);e||(e=await (0,l._x)(t.uid)),x(e),b(e?t:null)}catch(e){console.error("Error checking admin status:",e),x(!1),b(null)}finally{g(!1)}}})()},[t,c,u]),(0,a.jsx)(d.Provider,{value:{isAdmin:m,adminLoading:h,adminUser:p},children:s})},m=e=>function(s){let{isAdmin:t,adminLoading:l}=c(),i=(0,n.useRouter)();return((0,r.useEffect)(()=>{l||t||i.push("/admin/login")},[t,l,i]),l)?(0,a.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold mb-2",children:"Checking admin credentials..."}),(0,a.jsx)("p",{className:"text-gray-400",children:"Please wait while we verify your access."})]})}):t?(0,a.jsx)(e,{...s}):null}},5695:(e,s,t)=>{"use strict";var a=t(8999);t.o(a,"useParams")&&t.d(s,{useParams:function(){return a.useParams}}),t.o(a,"usePathname")&&t.d(s,{usePathname:function(){return a.usePathname}}),t.o(a,"useRouter")&&t.d(s,{useRouter:function(){return a.useRouter}}),t.o(a,"useSearchParams")&&t.d(s,{useSearchParams:function(){return a.useSearchParams}})},6546:(e,s,t)=>{Promise.resolve().then(t.bind(t,2899))},9599:(e,s,t)=>{"use strict";t.d(s,{Mu:()=>n,cb:()=>l});let a={viewer:0,guest:0,user:1,editor:2,moderator:3,admin:4,superadmin:5},r=(e,s)=>(a.hasOwnProperty(e)||(e="guest"),a.hasOwnProperty(s)||(s="guest"),a[e]>=a[s]),n=e=>r(e,"admin"),l=e=>({viewer:"Người xem",guest:"Kh\xe1ch",user:"Người d\xf9ng đ\xe3 đăng k\xfd",editor:"Bi\xean tập vi\xean",moderator:"Quản trị vi\xean nội dung",admin:"Quản trị vi\xean",superadmin:"Quản trị vi\xean cấp cao"})[e]||e}},e=>{var s=s=>e(e.s=s);e.O(0,[2992,9507,7158,883,283,8441,1684,7358],()=>s(6546)),_N_E=e.O()}]);