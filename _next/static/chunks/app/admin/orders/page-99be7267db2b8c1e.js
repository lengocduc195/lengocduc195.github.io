(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[4798],{425:(e,t,s)=>{Promise.resolve().then(s.bind(s,9720))},4126:(e,t,s)=>{"use strict";s.d(t,{AdminProvider:()=>h,P:()=>m,z:()=>o});var a=s(5155),l=s(2115),r=s(5695),n=s(6104),i=s(283),d=s(9599);let c=(0,l.createContext)({isAdmin:!1,adminLoading:!0,adminUser:null}),o=()=>(0,l.useContext)(c),h=e=>{let{children:t}=e,{currentUser:s,loading:o,userRole:h}=(0,i.A)(),[m,x]=(0,l.useState)(!1),[u,p]=(0,l.useState)(!0),[g,j]=(0,l.useState)(null);return(0,r.useRouter)(),(0,l.useEffect)(()=>{(async()=>{if(!o){if(!s){x(!1),j(null),p(!1);return}try{let e=(0,d.Mu)(h);e||(e=await (0,n._x)(s.uid)),x(e),j(e?s:null)}catch(e){console.error("Error checking admin status:",e),x(!1),j(null)}finally{p(!1)}}})()},[s,o,h]),(0,a.jsx)(c.Provider,{value:{isAdmin:m,adminLoading:u,adminUser:g},children:t})},m=e=>function(t){let{isAdmin:s,adminLoading:n}=o(),i=(0,r.useRouter)();return((0,l.useEffect)(()=>{n||s||i.push("/admin/login")},[s,n,i]),n)?(0,a.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold mb-2",children:"Checking admin credentials..."}),(0,a.jsx)("p",{className:"text-gray-400",children:"Please wait while we verify your access."})]})}):s?(0,a.jsx)(e,{...t}):null}},5695:(e,t,s)=>{"use strict";var a=s(8999);s.o(a,"useParams")&&s.d(t,{useParams:function(){return a.useParams}}),s.o(a,"usePathname")&&s.d(t,{usePathname:function(){return a.usePathname}}),s.o(a,"useRouter")&&s.d(t,{useRouter:function(){return a.useRouter}}),s.o(a,"useSearchParams")&&s.d(t,{useSearchParams:function(){return a.useSearchParams}})},9599:(e,t,s)=>{"use strict";s.d(t,{Mu:()=>r,cb:()=>n});let a={viewer:0,guest:0,user:1,editor:2,moderator:3,admin:4,superadmin:5},l=(e,t)=>(a.hasOwnProperty(e)||(e="guest"),a.hasOwnProperty(t)||(t="guest"),a[e]>=a[t]),r=e=>l(e,"admin"),n=e=>({viewer:"Người xem",guest:"Kh\xe1ch",user:"Người d\xf9ng đ\xe3 đăng k\xfd",editor:"Bi\xean tập vi\xean",moderator:"Quản trị vi\xean nội dung",admin:"Quản trị vi\xean",superadmin:"Quản trị vi\xean cấp cao"})[e]||e},9720:(e,t,s)=>{"use strict";s.r(t),s.d(t,{default:()=>i});var a=s(5155),l=s(2115),r=s(6104),n=s(1115);let i=(0,s(4126).P)(function(){let[e,t]=(0,l.useState)([]),[s,i]=(0,l.useState)(!0),[d,c]=(0,l.useState)(null),[o,h]=(0,l.useState)(null),[m,x]=(0,l.useState)(!1),[u,p]=(0,l.useState)("all"),[g,j]=(0,l.useState)(""),[y,N]=(0,l.useState)(""),[b,f]=(0,l.useState)(""),[v,w]=(0,l.useState)(!1),k=[{value:"pending",label:"Chờ xử l\xfd",color:"bg-yellow-500"},{value:"processing",label:"Đang xử l\xfd",color:"bg-blue-500"},{value:"shipped",label:"Đ\xe3 gửi h\xe0ng",color:"bg-purple-500"},{value:"delivered",label:"Đ\xe3 giao h\xe0ng",color:"bg-green-500"},{value:"cancelled",label:"Đ\xe3 hủy",color:"bg-red-500"},{value:"refunded",label:"Đ\xe3 ho\xe0n tiền",color:"bg-gray-500"}];(0,l.useEffect)(()=>{(async()=>{if(!r.v$){c("Firebase Realtime Database is not initialized"),i(!1);return}try{i(!0);let e=(0,n.KR)(r.v$,"orders"),s=(0,n.P)(e,(0,n.kT)("createdAt")),a=await (0,n.Jt)(s);if(a.exists()){let e=[];a.forEach(t=>{let s=t.val();e.push({...s,orderId:s.orderId||t.key})}),e.sort((e,t)=>new Date(t.createdAt).getTime()-new Date(e.createdAt).getTime()),t(e)}else t([]);i(!1)}catch(e){console.error("Error fetching orders:",e),c(e.message||"Failed to load orders"),i(!1)}})()},[]);let C=e.filter(e=>{let t="all"===u||e.status===u,s=""===g||e.orderId.toLowerCase().includes(g.toLowerCase())||e.customerInfo.name.toLowerCase().includes(g.toLowerCase())||e.customerInfo.email.toLowerCase().includes(g.toLowerCase())||e.customerInfo.phone.toLowerCase().includes(g.toLowerCase());return t&&s}),S=e=>{h(e),x(!0),N(e.status),f("")},I=async()=>{if(o&&y){w(!0);try{let s=new Date().toISOString(),a=(0,n.KR)(r.v$,"orders/".concat(o.orderId)),l={status:y,timestamp:s,note:b||"Trạng th\xe1i đơn h\xe0ng thay đổi th\xe0nh ".concat(y)},i=o.statusHistory||[];await (0,n.yo)(a,{status:y,updatedAt:s,statusHistory:[...i,l]}),t(e.map(e=>e.orderId===o.orderId?{...e,status:y,updatedAt:s,statusHistory:[...e.statusHistory||[],l]}:e)),h({...o,status:y,updatedAt:s,statusHistory:[...o.statusHistory||[],l]}),w(!1)}catch(e){console.error("Error updating order status:",e),c(e.message||"Failed to update order status"),w(!1)}}},P=e=>k.find(t=>t.value===e)||{value:e,label:e,color:"bg-gray-500"},T=e=>{let t=new Date(e);return new Intl.DateTimeFormat("vi-VN",{year:"numeric",month:"2-digit",day:"2-digit",hour:"2-digit",minute:"2-digit"}).format(t)},A=e=>new Intl.NumberFormat("vi-VN",{style:"currency",currency:"VND"}).format(e);return s?(0,a.jsxs)("div",{className:"container mx-auto p-6 pt-16",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold mb-6",children:"Quản l\xfd đơn h\xe0ng"}),(0,a.jsx)("div",{className:"bg-gray-800 rounded-lg p-6 shadow-lg",children:(0,a.jsx)("p",{className:"text-center",children:"Đang tải dữ liệu đơn h\xe0ng..."})})]}):d?(0,a.jsxs)("div",{className:"container mx-auto p-6 pt-16",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold mb-6",children:"Quản l\xfd đơn h\xe0ng"}),(0,a.jsx)("div",{className:"bg-red-900 rounded-lg p-6 shadow-lg",children:(0,a.jsxs)("p",{className:"text-center",children:["Lỗi: ",d]})})]}):(0,a.jsxs)("div",{className:"container mx-auto p-6 pt-16",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold mb-6",children:"Quản l\xfd đơn h\xe0ng"}),(0,a.jsx)("div",{className:"bg-gray-800 rounded-lg p-4 mb-6",children:(0,a.jsxs)("div",{className:"flex flex-wrap items-center gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Trạng th\xe1i:"}),(0,a.jsxs)("select",{value:u,onChange:e=>p(e.target.value),className:"bg-gray-700 text-white rounded px-3 py-2",children:[(0,a.jsx)("option",{value:"all",children:"Tất cả"}),k.map(e=>(0,a.jsx)("option",{value:e.value,children:e.label},e.value))]})]}),(0,a.jsxs)("div",{className:"flex-1",children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-1",children:"T\xecm kiếm:"}),(0,a.jsx)("input",{type:"text",value:g,onChange:e=>j(e.target.value),placeholder:"T\xecm theo m\xe3 đơn h\xe0ng, t\xean kh\xe1ch h\xe0ng, email, số điện thoại...",className:"w-full bg-gray-700 text-white rounded px-3 py-2"})]})]})}),(0,a.jsx)("div",{className:"bg-gray-800 rounded-lg shadow-lg overflow-hidden",children:(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"min-w-full divide-y divide-gray-700",children:[(0,a.jsx)("thead",{className:"bg-gray-900",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider",children:"M\xe3 đơn h\xe0ng"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider",children:"Ng\xe0y đặt"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider",children:"Kh\xe1ch h\xe0ng"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider",children:"Tổng tiền"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider",children:"Trạng th\xe1i"}),(0,a.jsx)("th",{className:"px-6 py-3 text-left text-xs font-medium text-gray-400 uppercase tracking-wider",children:"Thao t\xe1c"})]})}),(0,a.jsx)("tbody",{className:"bg-gray-800 divide-y divide-gray-700",children:C.length>0?C.map(e=>(0,a.jsxs)("tr",{className:"hover:bg-gray-750",children:[(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm font-medium",children:e.orderId}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:T(e.createdAt)}),(0,a.jsxs)("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:[(0,a.jsx)("div",{children:e.customerInfo.name}),(0,a.jsx)("div",{className:"text-gray-400",children:e.customerInfo.phone})]}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:A(e.total)}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:(0,a.jsx)("span",{className:"px-2 py-1 rounded-full text-xs ".concat(P(e.status).color),children:P(e.status).label})}),(0,a.jsx)("td",{className:"px-6 py-4 whitespace-nowrap text-sm",children:(0,a.jsx)("button",{onClick:()=>S(e),className:"text-blue-500 hover:text-blue-400",children:"Chi tiết"})})]},e.orderId)):(0,a.jsx)("tr",{children:(0,a.jsx)("td",{colSpan:6,className:"px-6 py-4 text-center text-sm",children:"Kh\xf4ng t\xecm thấy đơn h\xe0ng n\xe0o"})})})]})})}),m&&o&&(0,a.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,a.jsx)("div",{className:"bg-gray-800 rounded-lg shadow-lg w-full max-w-4xl max-h-[90vh] overflow-y-auto",children:(0,a.jsxs)("div",{className:"p-6",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-4",children:[(0,a.jsxs)("h2",{className:"text-xl font-bold",children:["Chi tiết đơn h\xe0ng #",o.orderId]}),(0,a.jsx)("button",{onClick:()=>{x(!1),h(null)},className:"text-gray-400 hover:text-white",children:"\xd7"})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-semibold mb-2",children:"Th\xf4ng tin kh\xe1ch h\xe0ng"}),(0,a.jsxs)("div",{className:"bg-gray-700 rounded-lg p-4",children:[(0,a.jsxs)("p",{children:[(0,a.jsx)("span",{className:"font-medium",children:"T\xean:"})," ",o.customerInfo.name]}),(0,a.jsxs)("p",{children:[(0,a.jsx)("span",{className:"font-medium",children:"Email:"})," ",o.customerInfo.email]}),(0,a.jsxs)("p",{children:[(0,a.jsx)("span",{className:"font-medium",children:"Điện thoại:"})," ",o.customerInfo.phone]}),(0,a.jsxs)("p",{children:[(0,a.jsx)("span",{className:"font-medium",children:"Địa chỉ:"})," ",o.customerInfo.address]})]})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"text-lg font-semibold mb-2",children:"Th\xf4ng tin đơn h\xe0ng"}),(0,a.jsxs)("div",{className:"bg-gray-700 rounded-lg p-4",children:[(0,a.jsxs)("p",{children:[(0,a.jsx)("span",{className:"font-medium",children:"Ng\xe0y đặt:"})," ",T(o.createdAt)]}),(0,a.jsxs)("p",{children:[(0,a.jsx)("span",{className:"font-medium",children:"Phương thức thanh to\xe1n:"})," ",o.paymentMethod]}),(0,a.jsxs)("p",{children:[(0,a.jsx)("span",{className:"font-medium",children:"Phương thức vận chuyển:"})," ",o.shippingMethod]}),(0,a.jsxs)("p",{children:[(0,a.jsx)("span",{className:"font-medium",children:"Trạng th\xe1i:"}),(0,a.jsx)("span",{className:"ml-2 px-2 py-1 rounded-full text-xs ".concat(P(o.status).color),children:P(o.status).label})]})]})]})]}),(0,a.jsx)("h3",{className:"text-lg font-semibold mb-2",children:"Sản phẩm"}),(0,a.jsx)("div",{className:"bg-gray-700 rounded-lg overflow-hidden mb-6",children:(0,a.jsxs)("table",{className:"min-w-full divide-y divide-gray-600",children:[(0,a.jsx)("thead",{className:"bg-gray-800",children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"px-4 py-2 text-left text-xs font-medium text-gray-400 uppercase tracking-wider",children:"Sản phẩm"}),(0,a.jsx)("th",{className:"px-4 py-2 text-right text-xs font-medium text-gray-400 uppercase tracking-wider",children:"Gi\xe1"}),(0,a.jsx)("th",{className:"px-4 py-2 text-right text-xs font-medium text-gray-400 uppercase tracking-wider",children:"Số lượng"}),(0,a.jsx)("th",{className:"px-4 py-2 text-right text-xs font-medium text-gray-400 uppercase tracking-wider",children:"Th\xe0nh tiền"})]})}),(0,a.jsx)("tbody",{className:"divide-y divide-gray-600",children:o.items.map((e,t)=>(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{className:"px-4 py-2",children:e.name}),(0,a.jsx)("td",{className:"px-4 py-2 text-right",children:A(e.price)}),(0,a.jsx)("td",{className:"px-4 py-2 text-right",children:e.quantity}),(0,a.jsx)("td",{className:"px-4 py-2 text-right",children:A(e.price*e.quantity)})]},t))}),(0,a.jsxs)("tfoot",{className:"bg-gray-800",children:[(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{colSpan:3,className:"px-4 py-2 text-right font-medium",children:"Tạm t\xednh:"}),(0,a.jsx)("td",{className:"px-4 py-2 text-right",children:A(o.subtotal)})]}),(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{colSpan:3,className:"px-4 py-2 text-right font-medium",children:"Ph\xed vận chuyển:"}),(0,a.jsx)("td",{className:"px-4 py-2 text-right",children:A(o.shippingCost)})]}),(0,a.jsxs)("tr",{children:[(0,a.jsx)("td",{colSpan:3,className:"px-4 py-2 text-right font-medium",children:"Tổng cộng:"}),(0,a.jsx)("td",{className:"px-4 py-2 text-right font-bold",children:A(o.total)})]})]})]})}),(0,a.jsx)("h3",{className:"text-lg font-semibold mb-2",children:"Cập nhật trạng th\xe1i"}),(0,a.jsxs)("div",{className:"bg-gray-700 rounded-lg p-4 mb-6",children:[(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Trạng th\xe1i mới:"}),(0,a.jsx)("select",{value:y,onChange:e=>N(e.target.value),className:"w-full bg-gray-600 text-white rounded px-3 py-2",children:k.map(e=>(0,a.jsx)("option",{value:e.value,children:e.label},e.value))})]}),(0,a.jsxs)("div",{className:"md:col-span-2",children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Ghi ch\xfa:"}),(0,a.jsx)("input",{type:"text",value:b,onChange:e=>f(e.target.value),placeholder:"Ghi ch\xfa về việc thay đổi trạng th\xe1i",className:"w-full bg-gray-600 text-white rounded px-3 py-2"})]})]}),(0,a.jsx)("button",{onClick:I,disabled:v||o.status===y,className:"mt-4 bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded disabled:opacity-50 disabled:cursor-not-allowed",children:v?"Đang cập nhật...":"Cập nhật trạng th\xe1i"})]}),(0,a.jsx)("h3",{className:"text-lg font-semibold mb-2",children:"Lịch sử trạng th\xe1i"}),(0,a.jsx)("div",{className:"bg-gray-700 rounded-lg p-4",children:o.statusHistory&&o.statusHistory.length>0?(0,a.jsx)("ul",{className:"space-y-2",children:[...o.statusHistory].reverse().map((e,t)=>(0,a.jsxs)("li",{className:"border-b border-gray-600 pb-2 last:border-0",children:[(0,a.jsxs)("div",{className:"flex items-center",children:[(0,a.jsx)("span",{className:"px-2 py-1 rounded-full text-xs ".concat(P(e.status).color," mr-2"),children:P(e.status).label}),(0,a.jsx)("span",{className:"text-gray-400 text-sm",children:T(e.timestamp)})]}),(0,a.jsx)("p",{className:"text-sm mt-1",children:e.note})]},t))}):(0,a.jsx)("p",{className:"text-gray-400",children:"Kh\xf4ng c\xf3 lịch sử trạng th\xe1i"})})]})})})]})})}},e=>{var t=t=>e(e.s=t);e.O(0,[2992,9507,7158,883,283,8441,1684,7358],()=>t(425)),_N_E=e.O()}]);