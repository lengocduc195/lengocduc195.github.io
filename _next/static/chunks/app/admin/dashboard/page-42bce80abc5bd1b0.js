(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[5957],{3418:(e,s,t)=>{Promise.resolve().then(t.bind(t,4163))},4126:(e,s,t)=>{"use strict";t.d(s,{AdminProvider:()=>x,P:()=>m,z:()=>o});var a=t(5155),r=t(2115),l=t(5695),i=t(6104),n=t(283),c=t(9599);let d=(0,r.createContext)({isAdmin:!1,adminLoading:!0,adminUser:null}),o=()=>(0,r.useContext)(d),x=e=>{let{children:s}=e,{currentUser:t,loading:o,userRole:x}=(0,n.A)(),[m,h]=(0,r.useState)(!1),[u,g]=(0,r.useState)(!0),[p,b]=(0,r.useState)(null);return(0,l.useRouter)(),(0,r.useEffect)(()=>{(async()=>{if(!o){if(!t){h(!1),b(null),g(!1);return}try{let e=(0,c.Mu)(x);e||(e=await (0,i._x)(t.uid)),h(e),b(e?t:null)}catch(e){console.error("Error checking admin status:",e),h(!1),b(null)}finally{g(!1)}}})()},[t,o,x]),(0,a.jsx)(d.Provider,{value:{isAdmin:m,adminLoading:u,adminUser:p},children:s})},m=e=>function(s){let{isAdmin:t,adminLoading:i}=o(),n=(0,l.useRouter)();return((0,r.useEffect)(()=>{i||t||n.push("/admin/login")},[t,i,n]),i)?(0,a.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold mb-2",children:"Checking admin credentials..."}),(0,a.jsx)("p",{className:"text-gray-400",children:"Please wait while we verify your access."})]})}):t?(0,a.jsx)(e,{...s}):null}},4163:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>o});var a=t(5155),r=t(2115),l=t(6874),i=t.n(l),n=t(4126),c=t(6104),d=t(1115);let o=(0,n.P)(function(){let[e,s]=(0,r.useState)({totalVisitors:0,totalPageViews:0,uniqueVisitors:0,countries:0,cities:0,totalUsers:0,registeredUsers:0,anonymousVisitors:0,usersByRole:{},topPages:{},topCountries:{},topCities:{},recentVisitors:[]}),[t,l]=(0,r.useState)(!0),[n,o]=(0,r.useState)(null),[x,m]=(0,r.useState)("all");return((0,r.useEffect)(()=>{(async()=>{if(!c.v$){o("Firebase Realtime Database is not initialized"),l(!1);return}try{let e=(0,d.KR)(c.v$,"analytics/visitors"),t=(0,d.P)(e,(0,d.kT)("timestamp"),(0,d.$1)(1e3)),a=await (0,d.Jt)(t),r=(0,d.KR)(c.v$,"analytics/pageViews"),i=(0,d.P)(r,(0,d.kT)("timestamp"),(0,d.$1)(1e3)),n=await (0,d.Jt)(i),o=(0,d.KR)(c.v$,"users"),m=await (0,d.Jt)(o);if(!a.exists()){s({totalVisitors:0,totalPageViews:0,uniqueVisitors:0,countries:0,cities:0,totalUsers:0,registeredUsers:0,anonymousVisitors:0,usersByRole:{},topPages:{},topCountries:{},topCities:{},recentVisitors:[]}),l(!1);return}let h=[],u=new Set,g=new Set,p=new Set,b={},j={},y={},N=Date.now(),f=0;switch(x){case"day":f=N-864e5;break;case"week":f=N-6048e5;break;case"month":f=N-2592e6;break;default:f=0}a.forEach(e=>{let s=e.val();if(s.id=e.key,(!s.timestamp||!(s.timestamp<f))&&(!s.page||!s.page.startsWith("/admin"))){var t,a;h.push(s),u.add(s.sessionId),(null==(t=s.location)?void 0:t.country)&&(g.add(s.location.country),j[s.location.country]=(j[s.location.country]||0)+1),(null==(a=s.location)?void 0:a.city)&&(p.add(s.location.city),y[s.location.city]=(y[s.location.city]||0)+1)}}),n.exists()&&n.forEach(e=>{let s=e.val();s.timestamp&&s.timestamp<f||(b[s.page]=(b[s.page]||0)+1)});let v=Object.entries(b).sort((e,s)=>s[1]-e[1]).slice(0,5).reduce((e,s)=>{let[t,a]=s;return{...e,[t]:a}},{}),w=Object.entries(j).sort((e,s)=>s[1]-e[1]).slice(0,5).reduce((e,s)=>{let[t,a]=s;return{...e,[t]:a}},{}),P=Object.entries(y).sort((e,s)=>s[1]-e[1]).slice(0,5).reduce((e,s)=>{let[t,a]=s;return{...e,[t]:a}},{}),k=[...h].sort((e,s)=>(s.timestamp||0)-(e.timestamp||0)).slice(0,10),V=0,C=0,U=0,S=new Set;h.forEach(e=>{e.isAuthenticated&&e.sessionId&&S.add(e.sessionId)}),C=S.size;let R={viewer:U=u.size-S.size,user:0,editor:0,moderator:0,admin:0,superadmin:0};m.exists()&&m.forEach(e=>{V++;let s=e.val().role||"user";R[s]=(R[s]||0)+1});let O=Object.values(b).reduce((e,s)=>e+s,0),E=u.size;h.length,s({totalVisitors:E,totalPageViews:O,uniqueVisitors:E,countries:g.size,cities:p.size,totalUsers:V,registeredUsers:C,anonymousVisitors:U,usersByRole:R,topPages:v,topCountries:w,topCities:P,recentVisitors:k}),l(!1)}catch(e){console.error("Error fetching dashboard data:",e),o(e.message||"Failed to load dashboard data"),l(!1)}})()},[x]),t)?(0,a.jsxs)("div",{className:"container mx-auto p-6",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold mb-6",children:"Admin Dashboard"}),(0,a.jsx)("p",{children:"Loading dashboard data..."})]}):n?(0,a.jsxs)("div",{className:"container mx-auto p-6",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold mb-6",children:"Admin Dashboard"}),(0,a.jsx)("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded",children:(0,a.jsx)("p",{children:n})})]}):(0,a.jsxs)("div",{className:"container mx-auto p-6",children:[(0,a.jsxs)("div",{className:"flex justify-between items-center mb-6",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold",children:"Admin Dashboard"}),(0,a.jsxs)("div",{className:"flex space-x-2",children:[(0,a.jsx)("button",{onClick:()=>m("day"),className:"px-3 py-1 rounded ".concat("day"===x?"bg-blue-600 text-white":"bg-gray-700 text-gray-300"),children:"24h"}),(0,a.jsx)("button",{onClick:()=>m("week"),className:"px-3 py-1 rounded ".concat("week"===x?"bg-blue-600 text-white":"bg-gray-700 text-gray-300"),children:"7d"}),(0,a.jsx)("button",{onClick:()=>m("month"),className:"px-3 py-1 rounded ".concat("month"===x?"bg-blue-600 text-white":"bg-gray-700 text-gray-300"),children:"30d"}),(0,a.jsx)("button",{onClick:()=>m("all"),className:"px-3 py-1 rounded ".concat("all"===x?"bg-blue-600 text-white":"bg-gray-700 text-gray-300"),children:"All"})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-6 mb-8",children:[(0,a.jsxs)("div",{className:"bg-gray-800 rounded-lg p-6 shadow-lg",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold text-gray-400 mb-2",children:"Page Views"}),(0,a.jsx)("p",{className:"text-3xl font-bold",children:e.totalPageViews}),(0,a.jsx)("p",{className:"text-xs text-gray-400 mt-1",children:"Tổng số lượt xem trang"})]}),(0,a.jsxs)("div",{className:"bg-gray-800 rounded-lg p-6 shadow-lg",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold text-gray-400 mb-2",children:"Registered Users"}),(0,a.jsx)("p",{className:"text-3xl font-bold",children:e.registeredUsers}),(0,a.jsx)("p",{className:"text-xs text-gray-400 mt-1",children:"Người d\xf9ng đ\xe3 đăng nhập"})]}),(0,a.jsxs)("div",{className:"bg-gray-800 rounded-lg p-6 shadow-lg",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold text-gray-400 mb-2",children:"Total Users"}),(0,a.jsx)("p",{className:"text-3xl font-bold",children:e.totalUsers}),(0,a.jsx)("p",{className:"text-xs text-gray-400 mt-1",children:"Người d\xf9ng đ\xe3 đăng k\xfd"})]})]}),(0,a.jsxs)("div",{className:"bg-gray-800 rounded-lg p-6 shadow-lg mb-8",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Visitor Breakdown"}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-6",children:[(0,a.jsxs)("div",{className:"bg-gray-700 rounded-lg p-4",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold mb-2",children:"Visitor Types"}),(0,a.jsxs)("div",{className:"flex justify-between items-center",children:[(0,a.jsxs)("div",{className:"text-center flex-1",children:[(0,a.jsx)("p",{className:"text-2xl font-bold",children:e.anonymousVisitors}),(0,a.jsx)("p",{className:"text-sm text-gray-400",children:"Kh\xe1ch kh\xf4ng đăng nhập"})]}),(0,a.jsxs)("div",{className:"text-center flex-1",children:[(0,a.jsx)("p",{className:"text-2xl font-bold",children:e.registeredUsers}),(0,a.jsx)("p",{className:"text-sm text-gray-400",children:"Người d\xf9ng đ\xe3 đăng nhập"})]})]})]}),(0,a.jsxs)("div",{className:"bg-gray-700 rounded-lg p-4",children:[(0,a.jsx)("h3",{className:"text-lg font-semibold mb-2",children:"Tỷ lệ đăng nhập"}),(0,a.jsx)("div",{className:"flex items-center justify-center h-full",children:(0,a.jsxs)("p",{className:"text-3xl font-bold",children:[e.registeredUsers+e.anonymousVisitors>0?Math.round(e.registeredUsers/(e.registeredUsers+e.anonymousVisitors)*100):0,"%"]})})]})]}),(0,a.jsx)("h3",{className:"text-lg font-semibold mb-2",children:"Users by Role"}),(0,a.jsx)("div",{className:"grid grid-cols-2 md:grid-cols-6 gap-4",children:Object.entries(e.usersByRole).map(e=>{let[s,t]=e;return(0,a.jsxs)("div",{className:"rounded-lg p-4 text-center ".concat("viewer"===s?"bg-gray-600":"user"===s?"bg-blue-900":"editor"===s?"bg-green-900":"moderator"===s?"bg-yellow-900":"admin"===s||"superadmin"===s?"bg-red-900":"bg-gray-700"),children:[(0,a.jsx)("p",{className:"text-lg font-bold",children:t}),(0,a.jsxs)("p",{className:"text-sm text-gray-300",children:[s.charAt(0).toUpperCase()+s.slice(1),"s"]})]},s)})}),(0,a.jsx)("div",{className:"mt-4",children:(0,a.jsx)(i(),{href:"/admin/users",className:"text-blue-500 hover:underline",children:"Manage users →"})})]}),(0,a.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6 mb-8",children:[(0,a.jsxs)("div",{className:"bg-gray-800 rounded-lg p-6 shadow-lg",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Top Pages"}),(0,a.jsxs)("table",{className:"min-w-full",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"text-left py-2 px-4",children:"Page"}),(0,a.jsx)("th",{className:"text-right py-2 px-4",children:"Views"})]})}),(0,a.jsxs)("tbody",{children:[Object.entries(e.topPages).map(e=>{let[s,t]=e;return(0,a.jsxs)("tr",{className:"border-t border-gray-700",children:[(0,a.jsx)("td",{className:"py-2 px-4 truncate max-w-[200px]",title:s,children:s}),(0,a.jsx)("td",{className:"text-right py-2 px-4",children:t})]},s)}),0===Object.keys(e.topPages).length&&(0,a.jsx)("tr",{children:(0,a.jsx)("td",{colSpan:2,className:"py-4 text-center text-gray-400",children:"No page view data available"})})]})]}),(0,a.jsx)("div",{className:"mt-4",children:(0,a.jsx)(i(),{href:"/admin/analytics",className:"text-blue-500 hover:underline",children:"View all analytics →"})})]}),(0,a.jsxs)("div",{className:"bg-gray-800 rounded-lg p-6 shadow-lg",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Top Countries"}),(0,a.jsxs)("table",{className:"min-w-full",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"text-left py-2 px-4",children:"Country"}),(0,a.jsx)("th",{className:"text-right py-2 px-4",children:"Visitors"})]})}),(0,a.jsxs)("tbody",{children:[Object.entries(e.topCountries).map(e=>{let[s,t]=e;return(0,a.jsxs)("tr",{className:"border-t border-gray-700",children:[(0,a.jsx)("td",{className:"py-2 px-4",children:s}),(0,a.jsx)("td",{className:"text-right py-2 px-4",children:t})]},s)}),0===Object.keys(e.topCountries).length&&(0,a.jsx)("tr",{children:(0,a.jsx)("td",{colSpan:2,className:"py-4 text-center text-gray-400",children:"No country data available"})})]})]}),(0,a.jsx)("div",{className:"mt-4",children:(0,a.jsx)(i(),{href:"/admin/location-analytics",className:"text-blue-500 hover:underline",children:"View location analytics →"})})]})]}),(0,a.jsxs)("div",{className:"bg-gray-800 rounded-lg p-6 shadow-lg mb-8",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Recent Visitors"}),(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"min-w-full",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"text-left py-2 px-4",children:"Time"}),(0,a.jsx)("th",{className:"text-left py-2 px-4",children:"Page"}),(0,a.jsx)("th",{className:"text-left py-2 px-4",children:"Location"}),(0,a.jsx)("th",{className:"text-left py-2 px-4",children:"Browser"}),(0,a.jsx)("th",{className:"text-left py-2 px-4",children:"Device"}),(0,a.jsx)("th",{className:"text-left py-2 px-4",children:"Actions"})]})}),(0,a.jsxs)("tbody",{children:[e.recentVisitors.map(e=>{var s,t,r;return(0,a.jsxs)("tr",{className:"border-t border-gray-700",children:[(0,a.jsx)("td",{className:"py-2 px-4",children:e.timestamp?new Date(e.timestamp).toLocaleString():"Unknown"}),(0,a.jsx)("td",{className:"py-2 px-4 truncate max-w-[150px]",title:e.page,children:e.page||"Unknown"}),(0,a.jsx)("td",{className:"py-2 px-4",children:e.location?(0,a.jsx)("span",{children:[e.location.city,e.location.country].filter(Boolean).join(", ")||"Unknown"}):"Unknown"}),(0,a.jsxs)("td",{className:"py-2 px-4",children:[(null==(s=e.browserInfo)?void 0:s.browser)||"Unknown"," ",(null==(t=e.browserInfo)?void 0:t.version)||""]}),(0,a.jsx)("td",{className:"py-2 px-4",children:(null==(r=e.browserInfo)?void 0:r.mobile)?"Mobile":"Desktop"}),(0,a.jsx)("td",{className:"py-2 px-4",children:(0,a.jsx)(i(),{href:"/admin/visitor/".concat(e.id),className:"text-blue-500 hover:underline",children:"Details"})})]},e.id)}),0===e.recentVisitors.length&&(0,a.jsx)("tr",{children:(0,a.jsx)("td",{colSpan:6,className:"py-4 text-center text-gray-400",children:"No visitor data available"})})]})]})}),(0,a.jsx)("div",{className:"mt-4",children:(0,a.jsx)(i(),{href:"/admin/analytics",className:"text-blue-500 hover:underline",children:"View all visitors →"})})]})]})})},5695:(e,s,t)=>{"use strict";var a=t(8999);t.o(a,"useParams")&&t.d(s,{useParams:function(){return a.useParams}}),t.o(a,"usePathname")&&t.d(s,{usePathname:function(){return a.usePathname}}),t.o(a,"useRouter")&&t.d(s,{useRouter:function(){return a.useRouter}}),t.o(a,"useSearchParams")&&t.d(s,{useSearchParams:function(){return a.useSearchParams}})},9599:(e,s,t)=>{"use strict";t.d(s,{Mu:()=>l,cb:()=>i});let a={viewer:0,guest:0,user:1,editor:2,moderator:3,admin:4,superadmin:5},r=(e,s)=>(a.hasOwnProperty(e)||(e="guest"),a.hasOwnProperty(s)||(s="guest"),a[e]>=a[s]),l=e=>r(e,"admin"),i=e=>({viewer:"Người xem",guest:"Kh\xe1ch",user:"Người d\xf9ng đ\xe3 đăng k\xfd",editor:"Bi\xean tập vi\xean",moderator:"Quản trị vi\xean nội dung",admin:"Quản trị vi\xean",superadmin:"Quản trị vi\xean cấp cao"})[e]||e}},e=>{var s=s=>e(e.s=s);e.O(0,[2992,9507,7158,6874,883,283,8441,1684,7358],()=>s(3418)),_N_E=e.O()}]);