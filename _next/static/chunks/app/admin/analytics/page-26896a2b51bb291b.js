(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[1093],{387:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>h});var a=t(5155),r=t(2115),n=t(283),l=t(9850),i=t(6874),c=t.n(i),o=t(4126);let d=e=>{let{visitors:s}=e,[t,n]=(0,r.useState)(1),l=Math.ceil(s.length/10),i=10*t,o=s.slice(i-10,i),d=e=>n(e);return(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"min-w-full",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"text-left py-2 px-4",children:"Time"}),(0,a.jsx)("th",{className:"text-left py-2 px-4",children:"Local Time"}),(0,a.jsx)("th",{className:"text-left py-2 px-4",children:"Page"}),(0,a.jsx)("th",{className:"text-left py-2 px-4",children:"Location"}),(0,a.jsx)("th",{className:"text-left py-2 px-4",children:"Browser"}),(0,a.jsx)("th",{className:"text-left py-2 px-4",children:"OS"}),(0,a.jsx)("th",{className:"text-left py-2 px-4",children:"Device"}),(0,a.jsx)("th",{className:"text-left py-2 px-4",children:"Referrer"})]})}),(0,a.jsx)("tbody",{children:o.map((e,s)=>{var t,r,n,l;return(0,a.jsxs)("tr",{className:"border-t border-gray-700 hover:bg-gray-700",children:[(0,a.jsx)("td",{className:"py-2 px-4",children:(0,a.jsx)(c(),{href:"/admin/visitor/".concat(e.id),className:"text-blue-500 hover:underline",children:e.timestamp?new Date(e.timestamp).toLocaleString():"Unknown"})}),(0,a.jsx)("td",{className:"py-2 px-4",children:e.localTime||"Unknown"}),(0,a.jsx)("td",{className:"py-2 px-4",children:e.page||"Unknown"}),(0,a.jsx)("td",{className:"py-2 px-4",children:e.location?(0,a.jsx)("span",{title:"".concat(e.location.latitude,", ").concat(e.location.longitude),children:[e.location.city,e.location.region,e.location.country].filter(Boolean).join(", ")||"Unknown"}):"Unknown"}),(0,a.jsxs)("td",{className:"py-2 px-4",children:[(null==(t=e.browserInfo)?void 0:t.browser)||"Unknown"," ",(null==(r=e.browserInfo)?void 0:r.version)||""]}),(0,a.jsx)("td",{className:"py-2 px-4",children:(null==(n=e.browserInfo)?void 0:n.os)||"Unknown"}),(0,a.jsx)("td",{className:"py-2 px-4",children:(null==(l=e.browserInfo)?void 0:l.mobile)?"Mobile":"Desktop"}),(0,a.jsx)("td",{className:"py-2 px-4 max-w-xs truncate",title:e.referrer,children:e.referrer||"Direct"})]},s)})})]})}),l>1&&(0,a.jsx)("div",{className:"flex justify-center mt-4",children:(0,a.jsxs)("nav",{className:"flex items-center",children:[(0,a.jsx)("button",{onClick:()=>d(Math.max(1,t-1)),disabled:1===t,className:"px-3 py-1 rounded-l-md ".concat(1===t?"bg-gray-700 text-gray-400 cursor-not-allowed":"bg-gray-700 hover:bg-gray-600"),children:"\xab"}),(0,a.jsx)("div",{className:"flex",children:Array.from({length:l},(e,s)=>s+1).map(e=>(0,a.jsx)("button",{onClick:()=>d(e),className:"px-3 py-1 ".concat(t===e?"bg-blue-600 text-white":"bg-gray-700 hover:bg-gray-600"),children:e},e))}),(0,a.jsx)("button",{onClick:()=>d(Math.min(l,t+1)),disabled:t===l,className:"px-3 py-1 rounded-r-md ".concat(t===l?"bg-gray-700 text-gray-400 cursor-not-allowed":"bg-gray-700 hover:bg-gray-600"),children:"\xbb"})]})})]})},x=e=>{let{pageViews:s}=e,[t,n]=(0,r.useState)(1),l=Object.entries(s).map(e=>{let[s,t]=e;return{page:s,count:t}}).sort((e,s)=>s.count-e.count),i=Math.ceil(l.length/10),c=10*t,o=l.slice(c-10,c),d=e=>n(e);return(0,a.jsxs)("div",{children:[(0,a.jsx)("div",{className:"overflow-x-auto",children:(0,a.jsxs)("table",{className:"min-w-full",children:[(0,a.jsx)("thead",{children:(0,a.jsxs)("tr",{children:[(0,a.jsx)("th",{className:"text-left py-2 px-4",children:"Page"}),(0,a.jsx)("th",{className:"text-right py-2 px-4",children:"Views"})]})}),(0,a.jsx)("tbody",{children:o.map(e=>{let{page:s,count:t}=e;return(0,a.jsxs)("tr",{className:"border-t border-gray-700",children:[(0,a.jsx)("td",{className:"py-2 px-4",children:s}),(0,a.jsx)("td",{className:"text-right py-2 px-4",children:t})]},s)})})]})}),i>1&&(0,a.jsx)("div",{className:"flex justify-center mt-4",children:(0,a.jsxs)("nav",{className:"flex items-center",children:[(0,a.jsx)("button",{onClick:()=>d(Math.max(1,t-1)),disabled:1===t,className:"px-3 py-1 rounded-l-md ".concat(1===t?"bg-gray-700 text-gray-400 cursor-not-allowed":"bg-gray-700 hover:bg-gray-600"),children:"\xab"}),(0,a.jsx)("div",{className:"flex",children:Array.from({length:i},(e,s)=>s+1).map(e=>(0,a.jsx)("button",{onClick:()=>d(e),className:"px-3 py-1 ".concat(t===e?"bg-blue-600 text-white":"bg-gray-700 hover:bg-gray-600"),children:e},e))}),(0,a.jsx)("button",{onClick:()=>d(Math.min(i,t+1)),disabled:t===i,className:"px-3 py-1 rounded-r-md ".concat(t===i?"bg-gray-700 text-gray-400 cursor-not-allowed":"bg-gray-700 hover:bg-gray-600"),children:"\xbb"})]})})]})},h=(0,o.P)(function(){let{currentUser:e}=(0,n.A)(),[s,t]=(0,r.useState)([]),[i,c]=(0,r.useState)({}),[o,h]=(0,r.useState)(!0),[u,m]=(0,r.useState)(null);return((0,r.useEffect)(()=>{(async()=>{if(!e){m("You must be logged in to view analytics"),h(!1);return}try{let e=await (0,l.Xg)(50);t(e);let s={};e.forEach(e=>{let t=e.page||"unknown";s[t]=(s[t]||0)+1}),c(s),h(!1)}catch(e){console.error("Error fetching analytics data:",e),m("Failed to load analytics data"),h(!1)}})()},[e]),o)?(0,a.jsxs)("div",{className:"container mx-auto p-6",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold mb-6",children:"Analytics Dashboard"}),(0,a.jsx)("p",{children:"Loading analytics data..."})]}):u?(0,a.jsxs)("div",{className:"container mx-auto p-6",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold mb-6",children:"Analytics Dashboard"}),(0,a.jsx)("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded",children:(0,a.jsx)("p",{children:u})})]}):e?(0,a.jsxs)("div",{className:"container mx-auto p-6",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold mb-6",children:"Analytics Dashboard"}),(0,a.jsxs)("div",{className:"mb-8",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Page Views"}),(0,a.jsx)("div",{className:"bg-gray-800 rounded-lg p-4",children:(0,a.jsx)(x,{pageViews:i})})]}),(0,a.jsxs)("div",{className:"mb-8",children:[(0,a.jsxs)("h2",{className:"text-xl font-semibold mb-4",children:["Recent Visitors (",s.length,")"]}),(0,a.jsx)("div",{className:"bg-gray-800 rounded-lg p-4 overflow-x-auto",children:(0,a.jsx)(d,{visitors:s})})]})]}):(0,a.jsxs)("div",{className:"container mx-auto p-6",children:[(0,a.jsx)("h1",{className:"text-2xl font-bold mb-6",children:"Analytics Dashboard"}),(0,a.jsx)("div",{className:"bg-yellow-100 border border-yellow-400 text-yellow-700 px-4 py-3 rounded",children:(0,a.jsx)("p",{children:"You must be logged in to view analytics"})})]})})},2602:(e,s,t)=>{Promise.resolve().then(t.bind(t,387))},4126:(e,s,t)=>{"use strict";t.d(s,{AdminProvider:()=>x,P:()=>h,z:()=>d});var a=t(5155),r=t(2115),n=t(5695),l=t(6104),i=t(283),c=t(9599);let o=(0,r.createContext)({isAdmin:!1,adminLoading:!0,adminUser:null}),d=()=>(0,r.useContext)(o),x=e=>{let{children:s}=e,{currentUser:t,loading:d,userRole:x}=(0,i.A)(),[h,u]=(0,r.useState)(!1),[m,g]=(0,r.useState)(!0),[p,y]=(0,r.useState)(null);return(0,n.useRouter)(),(0,r.useEffect)(()=>{(async()=>{if(!d){if(!t){u(!1),y(null),g(!1);return}try{let e=(0,c.Mu)(x);e||(e=await (0,l._x)(t.uid)),u(e),y(e?t:null)}catch(e){console.error("Error checking admin status:",e),u(!1),y(null)}finally{g(!1)}}})()},[t,d,x]),(0,a.jsx)(o.Provider,{value:{isAdmin:h,adminLoading:m,adminUser:p},children:s})},h=e=>function(s){let{isAdmin:t,adminLoading:l}=d(),i=(0,n.useRouter)();return((0,r.useEffect)(()=>{l||t||i.push("/admin/login")},[t,l,i]),l)?(0,a.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,a.jsxs)("div",{className:"text-center",children:[(0,a.jsx)("h2",{className:"text-xl font-semibold mb-2",children:"Checking admin credentials..."}),(0,a.jsx)("p",{className:"text-gray-400",children:"Please wait while we verify your access."})]})}):t?(0,a.jsx)(e,{...s}):null}},5695:(e,s,t)=>{"use strict";var a=t(8999);t.o(a,"useParams")&&t.d(s,{useParams:function(){return a.useParams}}),t.o(a,"usePathname")&&t.d(s,{usePathname:function(){return a.usePathname}}),t.o(a,"useRouter")&&t.d(s,{useRouter:function(){return a.useRouter}}),t.o(a,"useSearchParams")&&t.d(s,{useSearchParams:function(){return a.useSearchParams}})},9599:(e,s,t)=>{"use strict";t.d(s,{Mu:()=>n,cb:()=>l});let a={viewer:0,guest:0,user:1,editor:2,moderator:3,admin:4,superadmin:5},r=(e,s)=>(a.hasOwnProperty(e)||(e="guest"),a.hasOwnProperty(s)||(s="guest"),a[e]>=a[s]),n=e=>r(e,"admin"),l=e=>({viewer:"Người xem",guest:"Kh\xe1ch",user:"Người d\xf9ng đ\xe3 đăng k\xfd",editor:"Bi\xean tập vi\xean",moderator:"Quản trị vi\xean nội dung",admin:"Quản trị vi\xean",superadmin:"Quản trị vi\xean cấp cao"})[e]||e},9850:(e,s,t)=>{"use strict";t.d(s,{Xg:()=>n});var a=t(6104),r=t(1115);let n=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100;if(!a.v$)return console.error("Firebase Realtime Database is not initialized"),[];try{let s=(0,r.KR)(a.v$,"analytics/visitors"),t=(0,r.P)(s,(0,r.kT)("timestamp"),(0,r.$1)(e)),n=await (0,r.Jt)(t);if(n.exists()){let e=[];return n.forEach(s=>{e.push({...s.val(),id:s.key})}),e.reverse()}return[]}catch(e){return console.error("Error getting recent visitors:",e),[]}}}},e=>{var s=s=>e(e.s=s);e.O(0,[2992,9507,7158,6874,883,283,8441,1684,7358],()=>s(2602)),_N_E=e.O()}]);