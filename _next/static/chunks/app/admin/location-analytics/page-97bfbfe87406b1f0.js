(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[3577],{1910:(e,t,n)=>{Promise.resolve().then(n.bind(n,2927))},2927:(e,t,n)=>{"use strict";n.r(t),n.d(t,{default:()=>a});var i=n(5155),o=n(2115),r=n(283),s=n(9850);let a=(0,n(4126).P)(function(){let{currentUser:e}=(0,r.A)(),[t,n]=(0,o.useState)([]),[a,c]=(0,o.useState)({country:{},region:{},city:{},district:{},ward:{},street:{},postalCode:{},timezone:{},isp:{},connectionType:{}}),[l,d]=(0,o.useState)(!0),[u,m]=(0,o.useState)(null);(0,o.useEffect)(()=>{(async()=>{if(!e){m("You must be logged in to view analytics"),d(!1);return}try{let e=await (0,s.Xg)(200);n(e);let t={country:{},region:{},city:{},district:{},ward:{},street:{},postalCode:{},timezone:{},isp:{},connectionType:{}};e.forEach(e=>{if(e.location){if(e.location.country){let n=e.location.countryCode?"".concat(e.location.country," (").concat(e.location.countryCode,")"):e.location.country;t.country[n]=(t.country[n]||0)+1}if(e.location.region){let n=e.location.regionCode?"".concat(e.location.region," (").concat(e.location.regionCode,")"):e.location.region;t.region[n]=(t.region[n]||0)+1}e.location.city&&(t.city[e.location.city]=(t.city[e.location.city]||0)+1),e.location.district&&(t.district[e.location.district]=(t.district[e.location.district]||0)+1),e.location.ward&&(t.ward[e.location.ward]=(t.ward[e.location.ward]||0)+1),e.location.street&&(t.street[e.location.street]=(t.street[e.location.street]||0)+1),e.location.postalCode&&(t.postalCode[e.location.postalCode]=(t.postalCode[e.location.postalCode]||0)+1),e.location.timezone&&(t.timezone[e.location.timezone]=(t.timezone[e.location.timezone]||0)+1),e.location.isp&&(t.isp[e.location.isp]=(t.isp[e.location.isp]||0)+1),e.location.connectionType&&(t.connectionType[e.location.connectionType]=(t.connectionType[e.location.connectionType]||0)+1)}}),c(t),d(!1)}catch(e){console.error("Error fetching analytics data:",e),m("Failed to load analytics data"),d(!1)}})()},[e]);let h=e=>Object.entries(e).sort((e,t)=>t[1]-e[1]).reduce((e,t)=>{let[n,i]=t;return e[n]=i,e},{});if(l)return(0,i.jsxs)("div",{className:"container mx-auto p-6",children:[(0,i.jsx)("h1",{className:"text-2xl font-bold mb-6",children:"Location Analytics"}),(0,i.jsx)("p",{children:"Loading analytics data..."})]});if(u)return(0,i.jsxs)("div",{className:"container mx-auto p-6",children:[(0,i.jsx)("h1",{className:"text-2xl font-bold mb-6",children:"Location Analytics"}),(0,i.jsx)("div",{className:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded",children:(0,i.jsx)("p",{children:u})})]});if(!e)return(0,i.jsxs)("div",{className:"container mx-auto p-6",children:[(0,i.jsx)("h1",{className:"text-2xl font-bold mb-6",children:"Location Analytics"}),(0,i.jsx)("div",{className:"bg-yellow-100 border border-yellow-400 text-yellow-700 px-4 py-3 rounded",children:(0,i.jsx)("p",{children:"You must be logged in to view analytics"})})]});h(a.country),h(a.region),h(a.city),h(a.district),h(a.ward),h(a.street),h(a.postalCode);let x=h(a.timezone);return h(a.isp),h(a.connectionType),(0,i.jsxs)("div",{className:"container mx-auto p-6",children:[(0,i.jsx)("h1",{className:"text-2xl font-bold mb-6",children:"Thống k\xea vị tr\xed"}),(0,i.jsxs)("div",{className:"bg-gray-800 rounded-lg p-6",children:[(0,i.jsx)("h2",{className:"text-xl font-semibold mb-4",children:"Timezones"}),(0,i.jsxs)("table",{className:"min-w-full",children:[(0,i.jsx)("thead",{children:(0,i.jsxs)("tr",{children:[(0,i.jsx)("th",{className:"text-left py-2 px-4",children:"Timezone"}),(0,i.jsx)("th",{className:"text-right py-2 px-4",children:"Lượt truy cập"}),(0,i.jsx)("th",{className:"text-right py-2 px-4",children:"Phần trăm"})]})}),(0,i.jsxs)("tbody",{children:[Object.entries(x).map(e=>{let[n,o]=e;return(0,i.jsxs)("tr",{className:"border-t border-gray-700",children:[(0,i.jsx)("td",{className:"py-2 px-4",children:n}),(0,i.jsx)("td",{className:"text-right py-2 px-4",children:o}),(0,i.jsxs)("td",{className:"text-right py-2 px-4",children:[(o/t.length*100).toFixed(1),"%"]})]},n)}),0===Object.keys(x).length&&(0,i.jsx)("tr",{children:(0,i.jsx)("td",{colSpan:3,className:"py-4 text-center text-gray-400",children:"Kh\xf4ng c\xf3 dữ liệu timezone"})})]})]})]})]})})},4126:(e,t,n)=>{"use strict";n.d(t,{AdminProvider:()=>u,P:()=>m,z:()=>d});var i=n(5155),o=n(2115),r=n(5695),s=n(6104),a=n(283),c=n(9599);let l=(0,o.createContext)({isAdmin:!1,adminLoading:!0,adminUser:null}),d=()=>(0,o.useContext)(l),u=e=>{let{children:t}=e,{currentUser:n,loading:d,userRole:u}=(0,a.A)(),[m,h]=(0,o.useState)(!1),[x,y]=(0,o.useState)(!0),[p,g]=(0,o.useState)(null);return(0,r.useRouter)(),(0,o.useEffect)(()=>{(async()=>{if(!d){if(!n){h(!1),g(null),y(!1);return}try{let e=(0,c.Mu)(u);e||(e=await (0,s._x)(n.uid)),h(e),g(e?n:null)}catch(e){console.error("Error checking admin status:",e),h(!1),g(null)}finally{y(!1)}}})()},[n,d,u]),(0,i.jsx)(l.Provider,{value:{isAdmin:m,adminLoading:x,adminUser:p},children:t})},m=e=>function(t){let{isAdmin:n,adminLoading:s}=d(),a=(0,r.useRouter)();return((0,o.useEffect)(()=>{s||n||a.push("/admin/login")},[n,s,a]),s)?(0,i.jsx)("div",{className:"flex items-center justify-center min-h-screen",children:(0,i.jsxs)("div",{className:"text-center",children:[(0,i.jsx)("h2",{className:"text-xl font-semibold mb-2",children:"Checking admin credentials..."}),(0,i.jsx)("p",{className:"text-gray-400",children:"Please wait while we verify your access."})]})}):n?(0,i.jsx)(e,{...t}):null}},5695:(e,t,n)=>{"use strict";var i=n(8999);n.o(i,"useParams")&&n.d(t,{useParams:function(){return i.useParams}}),n.o(i,"usePathname")&&n.d(t,{usePathname:function(){return i.usePathname}}),n.o(i,"useRouter")&&n.d(t,{useRouter:function(){return i.useRouter}}),n.o(i,"useSearchParams")&&n.d(t,{useSearchParams:function(){return i.useSearchParams}})},9599:(e,t,n)=>{"use strict";n.d(t,{Mu:()=>r,cb:()=>s});let i={viewer:0,guest:0,user:1,editor:2,moderator:3,admin:4,superadmin:5},o=(e,t)=>(i.hasOwnProperty(e)||(e="guest"),i.hasOwnProperty(t)||(t="guest"),i[e]>=i[t]),r=e=>o(e,"admin"),s=e=>({viewer:"Người xem",guest:"Kh\xe1ch",user:"Người d\xf9ng đ\xe3 đăng k\xfd",editor:"Bi\xean tập vi\xean",moderator:"Quản trị vi\xean nội dung",admin:"Quản trị vi\xean",superadmin:"Quản trị vi\xean cấp cao"})[e]||e},9850:(e,t,n)=>{"use strict";n.d(t,{Xg:()=>r});var i=n(6104),o=n(1115);let r=async function(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:100;if(!i.v$)return console.error("Firebase Realtime Database is not initialized"),[];try{let t=(0,o.KR)(i.v$,"analytics/visitors"),n=(0,o.P)(t,(0,o.kT)("timestamp"),(0,o.$1)(e)),r=await (0,o.Jt)(n);if(r.exists()){let e=[];return r.forEach(t=>{e.push({...t.val(),id:t.key})}),e.reverse()}return[]}catch(e){return console.error("Error getting recent visitors:",e),[]}}}},e=>{var t=t=>e(e.s=t);e.O(0,[2992,9507,7158,883,283,8441,1684,7358],()=>t(1910)),_N_E=e.O()}]);